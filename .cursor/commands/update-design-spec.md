# 設計仕様書の更新

## 概要

既存の設計仕様書を更新・追記するコマンドです。機能の変更、新しい制限事項の発見、テストケースの追加などに使用します。

## 前提条件

- 更新対象の設計仕様書が `docs/specs/` に存在すること
- 更新内容が明確であること

## 実行手順

### Step 1: 現状確認

1. 対象の設計仕様書を読み込む
2. 更新が必要な箇所を特定
3. 関連するソースコードの変更を確認

### Step 2: 更新パターン

#### パターンA: 設計変更の追記

設計判断が変わった場合、「なぜその設計か」セクションを更新：

```markdown
### 3.2 なぜその設計か

| 選択肢 | メリット | デメリット | 判断 |
|--------|---------|-----------|------|
| 案A | ... | ... | ✅ 採用 |
| 案B（旧実装） | ... | ... | ❌ 不採用（v1.1で変更） |

**変更履歴**:
- v1.0: 案Bを採用
- v1.1: パフォーマンス問題により案Aに変更
```

#### パターンB: テストケース追加

新しいテストケースを追加：

```markdown
### 4.1 テストケース

| テストID | シナリオ | 前提条件 | 手順 | 期待結果 |
|----------|---------|---------|------|---------|
| XXX-001 | 既存テスト | ... | ... | ... |
| XXX-008 | 新規追加テスト | ... | ... | ... | ← 追加
```

#### パターンC: 制限事項の追加

新しく発見された制限を追記：

```markdown
## 5. 制限事項

| 制限 | 理由 | 回避策 |
|------|------|--------|
| 既存の制限 | ... | ... |
| 新しい制限 | 実装中に発見 | ... | ← 追加
```

#### パターンD: 今後の拡張の更新

実装済み機能を削除、新しい検討項目を追加：

```markdown
## 6. 今後の拡張

### 実装済み（v1.1）
- ~~ドラッグ&ドロップ対応~~ → 実装済み

### 検討中
- クリップボードからの貼り付け ← 新規追加
```

### Step 3: 更新履歴の記載

ドキュメント末尾に更新履歴を追加（なければ新規作成）：

```markdown
## 更新履歴

| 日付 | 内容 |
|------|------|
| 2025-11-26 | 初版作成 |
| 2025-11-27 | テストケースXXX-008追加 |
| 2025-11-28 | 制限事項に「～」を追加 |
```

### Step 4: 作業ログ記録

`docs/AGENT_WORK_LOG.md` に更新内容を記録。

## 注意事項

### 既存内容の削除について

- 古い情報でも**履歴として残す**ことを推奨
- 削除する場合は取り消し線（`~~テキスト~~`）を使用
- 完全削除は「明らかに誤りだった場合」のみ

### 一貫性の維持

- 既存のフォーマット・スタイルに合わせる
- テストIDの命名規則を維持
- 表の列構成を変えない

## 使用例

### テストケース追加

```
ユーザー: @update-design-spec api-key-management.mdにOAuth対応のテストケースを追加して

AI:
1. docs/specs/api-key-management.md を読み込み
2. 既存のテストケースID体系を確認（KEY-001など）
3. OAuth関連テストケースを追加（KEY-008〜）
4. 更新履歴を追記
5. 作業ログを記録
```

### 設計変更の記録

```
ユーザー: @update-design-spec multi-provider-llm.mdにストリーミング実装の変更理由を追記

AI:
1. docs/specs/multi-provider-llm.md を読み込み
2. 「なぜその設計か」セクションを特定
3. 変更理由と比較表を追記
4. 更新履歴を追記
5. 作業ログを記録
```

## 参照ルール

- `.cursor/rules/design-specification.mdc` - 設計仕様書のガイドライン

