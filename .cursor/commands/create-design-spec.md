# 設計仕様書の作成

## 概要

新規機能または既存機能の設計仕様書を `docs/specs/` に作成するコマンドです。

## 前提条件

- 設計対象の機能が明確であること
- 関連するソースコードが存在すること（新規の場合は設計段階でも可）

## 実行手順

### Step 1: 情報収集

以下の情報を収集・整理してください：

1. **要望の背景**
   - なぜこの機能が必要か
   - どのような問題を解決するか
   - ユーザーの期待は何か

2. **関連コードの確認**
   - 対象機能のソースコードを読む
   - 依存関係を把握する
   - 使用しているライブラリ/APIを特定する

3. **設計判断のポイント**
   - 他の選択肢は何があったか
   - なぜ現在の実装を選んだか
   - トレードオフは何か

### Step 2: ドキュメント作成

`docs/specs/{feature-name}.md` を作成し、以下のセクションを含めてください：

```markdown
# {機能名} 設計仕様書

## 1. 概要

### 1.1 要望

- ユーザー/ステークホルダーが何を求めているのか
- どのような問題を解決しようとしているのか

### 1.2 設計方針

- 採用した設計アプローチの概要
- 図やフローチャート（ASCII図可）

## 2. 要件定義（該当する場合）

### 2.1 機能要件

| 要件ID | 要件 | 優先度 |
|--------|------|--------|
| REQ-001 | ～できること | 必須/推奨 |

### 2.2 非機能要件

| 要件ID | 要件 | 優先度 |
|--------|------|--------|
| NFR-001 | ～であること | 必須/推奨 |

## 3. 設計詳細

### 3.1 モジュール構成 / データ構造 / API設計

- 実装の詳細
- コード例（重要な部分のみ抜粋）

### 3.2 なぜその設計か

| 選択肢 | メリット | デメリット | 判断 |
|--------|---------|-----------|------|
| 案A | ... | ... | ✅ 採用 |
| 案B | ... | ... | ❌ 不採用 |
| 案C | ... | ... | ❌ 不採用 |

**選択理由**: ...

## 4. テスト仕様

### 4.1 テストケース

| テストID | シナリオ | 前提条件 | 手順 | 期待結果 |
|----------|---------|---------|------|---------|
| XXX-001 | 正常系テスト | ... | ... | ... |
| XXX-002 | 異常系テスト | ... | ... | ... |

### 4.2 合格基準

| 基準ID | 基準 | 検証方法 |
|--------|------|---------|
| AC-001 | ... | ... |

## 5. 制限事項

| 制限 | 理由 | 回避策 |
|------|------|--------|
| ... | ... | ... |

## 6. 今後の拡張

- 検討中の機能
- 将来的な改善点
```

### Step 3: インデックス更新

`docs/specs/README.md` のドキュメント一覧に新規仕様書を追加：

```markdown
| [feature-name.md](./feature-name.md) | 機能の概要説明 |
```

### Step 4: 作業ログ記録

作業完了後、`docs/AGENT_WORK_LOG.md` に記録を追加してください。

## 重要なポイント

### 「なぜ」を必ず書く

❌ **悪い例**: 
> Office Settings APIを使用する

✅ **良い例**:
> Office Settings APIを使用する。  
> **理由**: localStorageと比較して、Microsoftアカウントによるデバイス間同期が可能であり、ブラウザデータ削除の影響を受けない。企業利用を想定すると、ローミング設定の方がユーザー体験が良い。

### 比較表を活用する

必ず「検討した選択肢」を明記する：

```markdown
| 選択肢 | メリット | デメリット | 判断 |
|--------|---------|-----------|------|
| localStorage | 実装簡単、どこでも動く | 同期なし、削除リスク | ❌ |
| IndexedDB | 大容量対応 | 過剰、同期なし | ❌ |
| Office Settings | MS同期、セキュア | Office環境限定 | ✅ |
```

### テスト仕様は具体的に

❌ **悪い例**:
> 正しく動作すること

✅ **良い例**:
> テストID IT-001〜IT-007がすべてパスすること。  
> 接続テスト成功時に「✓ 接続成功」が3秒間表示されること。

## 使用例

### 新規機能の場合

```
ユーザー: @create-design-spec APIキー管理機能の設計仕様書を作成して

AI:
1. src/taskpane/config.js を読み込み
2. 関連するtaskpane.jsのAPIキー関連コードを確認
3. 設計判断（環境変数 vs Office Settings vs localStorage）を整理
4. docs/specs/api-key-management.md を作成
5. docs/specs/README.md を更新
6. 作業ログを記録
```

### 既存機能の追記の場合

```
ユーザー: @create-design-spec excel-integration.mdにコード実行のセキュリティ考慮を追記して

AI:
1. docs/specs/excel-integration.md を読み込み
2. src/taskpane/taskpane.js のコード実行部分を確認
3. セキュリティ考慮セクションを追記
4. 作業ログを記録
```

## 参照ルール

- `.cursor/rules/design-specification.mdc` - 設計仕様書の詳細なガイドライン
- `docs/specs/` 配下の既存仕様書 - 記述スタイルの参考

