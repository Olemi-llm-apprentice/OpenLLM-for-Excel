---
description: 設計仕様書の作成ルール
globs: ["docs/specs/**/*.md"]
alwaysApply: false
---

# 設計仕様書作成ルール

設計仕様書を作成・更新する際に従うべきガイドラインを定義する。

---

## 1. 目的

設計仕様書は以下の目的で作成する：

1. **意思決定の記録** - なぜその設計を選んだのか、他の選択肢と比較してどう判断したのか
2. **知識の共有** - 後から参加するメンバーや将来の自分が理解できるように
3. **テスト基準の明確化** - 何をどうテストすれば「正しく動作している」と言えるのか
4. **保守性の向上** - 将来の変更時に影響範囲を把握しやすくする

---

## 2. ドキュメント配置

- **保存先**: `docs/specs/`
- **ファイル名**: 機能名をケバブケースで表現（例: `api-key-management.md`）
- **インデックス**: `docs/specs/README.md` に一覧を記載

### フォルダ構成例

```
docs/specs/
├── README.md                  # ドキュメント一覧と全体概要
├── architecture.md            # 全体アーキテクチャ
├── {feature-name}.md          # 機能別仕様書
└── ...
```

---

## 3. 必須セクション構成

各設計仕様書には以下のセクションを含めること：

### 3.1 概要

```markdown
## 1. 概要

### 1.1 要望

- ユーザー/ステークホルダーが何を求めているのか
- どのような問題を解決しようとしているのか

### 1.2 設計方針

- 採用した設計アプローチの概要
- 図やフローチャートがあれば記載
```

### 3.2 要件定義（必要に応じて）

```markdown
## 2. 要件定義

### 2.1 機能要件

| 要件ID | 要件 | 優先度 |
|--------|------|--------|
| REQ-001 | ～できること | 必須/推奨/任意 |

### 2.2 非機能要件

| 要件ID | 要件 | 優先度 |
|--------|------|--------|
| NFR-001 | ～であること | 必須/推奨/任意 |
```

### 3.3 設計詳細

```markdown
## 3. 設計詳細

### 3.1 モジュール構成 / データ構造 / API設計など

- 実装の詳細
- コード例（重要な部分のみ）

### 3.2 なぜその設計か（重要）

| 選択肢 | メリット | デメリット | 判断 |
|--------|---------|-----------|------|
| 案A | ... | ... | ✅ 採用 |
| 案B | ... | ... | ❌ 不採用 |
```

### 3.4 テスト仕様

```markdown
## 4. テスト仕様

### 4.1 テストケース

| テストID | シナリオ | 前提条件 | 手順 | 期待結果 |
|----------|---------|---------|------|---------|
| XXX-001 | ... | ... | ... | ... |

### 4.2 合格基準

| 基準ID | 基準 | 検証方法 |
|--------|------|---------|
| AC-001 | ... | ... |
```

### 3.5 制限事項と今後の拡張

```markdown
## 5. 制限事項

| 制限 | 理由 | 回避策 |
|------|------|--------|
| ... | ... | ... |

## 6. 今後の拡張

- 検討中の機能
- 将来的な改善点
```

---

## 4. 記述のガイドライン

### 4.1 「なぜ」を必ず書く

**悪い例**:
> WebpackのDefinePluginを使用する

**良い例**:
> WebpackのDefinePluginを使用する。  
> **理由**: ブラウザ環境では `process.env` が存在しないため、ビルド時に文字列として埋め込む必要がある。Viteの `import.meta.env` も検討したが、Office Add-inの公式テンプレートがWebpackベースのため、既存構成を活かす判断をした。

### 4.2 比較表を活用する

複数の選択肢がある場合は、必ず比較表を作成する：

```markdown
| 選択肢 | メリット | デメリット | 判断 |
|--------|---------|-----------|------|
| localStorage | 実装簡単 | 同期なし | ❌ |
| Office Settings | MS同期 | Office限定 | ✅ |
```

### 4.3 コード例は最小限に

- 全体のコードではなく、設計の意図が伝わる部分だけ抜粋
- 詳細な実装はソースコード自体を参照

### 4.4 図を活用する

- ASCII図やMermaidでフローを表現
- 複雑な処理はシーケンス図やフローチャートで

```
┌─────────┐     ┌─────────┐     ┌─────────┐
│ Client  │────►│ Module  │────►│   API   │
└─────────┘     └─────────┘     └─────────┘
```

---

## 5. テスト仕様の書き方

### 5.1 テストID命名規則

- `{機能略称}-{番号}`: 例: `KEY-001`, `LLM-002`
- 正常系: `XXX-N-xxx`（N = Normal）
- 異常系: `XXX-A-xxx`（A = Abnormal）

### 5.2 合格基準の明確化

曖昧な基準は避ける：

**悪い例**:
> 正しく動作すること

**良い例**:
> IT-001〜IT-007のすべてのテストケースがパスすること  
> エラー時にユーザーにフィードバックが表示されること

---

## 6. 更新ルール

### 6.1 更新タイミング

- 新機能追加時
- 既存機能の仕様変更時
- 設計判断の見直し時

### 6.2 更新履歴

ドキュメントの末尾に更新履歴を記載（任意）：

```markdown
## 更新履歴

| 日付 | 内容 |
|------|------|
| 2025-11-26 | 初版作成 |
| 2025-12-01 | テストケース追加 |
```

---

## 7. テンプレート

新規仕様書を作成する際は、以下のテンプレートを使用する：

```markdown
# {機能名} 設計仕様書

## 1. 概要

### 1.1 要望

- 

### 1.2 設計方針

## 2. 設計詳細

### 2.1 {サブセクション}

### 2.2 なぜその設計か

| 選択肢 | メリット | デメリット | 判断 |
|--------|---------|-----------|------|
| | | | |

## 3. テスト仕様

### 3.1 テストケース

| テストID | シナリオ | 前提条件 | 手順 | 期待結果 |
|----------|---------|---------|------|---------|
| | | | | |

### 3.2 合格基準

| 基準ID | 基準 | 検証方法 |
|--------|------|---------|
| | | |

## 4. 制限事項

| 制限 | 理由 | 回避策 |
|------|------|--------|
| | | |

## 5. 今後の拡張

- 
```

---

このルールに従い、設計意図が明確で保守しやすいドキュメントを作成すること。
